<apex:page >
    <script type="text/javascript" src="/support/api/49.0/lightning/opencti_min.js"></script>
    <script src="/soap/ajax/9.0/connection.js" type="text/javascript"></script>
Enter Text : <input id="entertexttoPublish" name="input1" type="text" />
<button onclick="subscribeToSampleMC()">Subscribe</button>
<div id="subsdivarea" style="color:green"></div>

<button onclick="unsubscribeToSampleMC()">UnSubscribe</button>
<div id="unsubsdivarea" style="color:red"></div>

<button onclick="publishSampleMC()">Publish</button>
<div id="publishdivarea" style="color:orange"></div>

<p>Received a Message : </p>
<textarea id="textareatoshowMsg" rows="10" style="disabled:true;resize:none;width:100%;" />

<script type="text/javascript">

    let channelName = 'SampleMessageChannel__c';
    let channelSubscription;

    function subscribeToSampleMC() {
            try{
                //console.log('channelSubscription---'+channelSubscription);
                //console.log('channelSubscription---'+JSON.stringify(channelSubscription));
                if (!channelSubscription) {
                    sforce.opencti.subscribe({channelName: channelName, listener: onPublishMessage, callback: subscribeSampleMCCallback});

                }
            }catch(ex){
                console.log('Error---'+ex);
            }
        }
        function unsubscribeToSampleMC() {
            try{
                if (channelSubscription) {
                    sforce.opencti.unsubscribe({subscription: channelName, callback: lightningMessageServiceCallback});

                    channelSubscription = null;
                }
            }catch(ex){
                console.log(`Error---${ex}`);
            }
        }
        function publishSampleMC(dataToPublish) {
            try{
                const message = {
                    /*from: "LightningMessageService_OpenCTI_TestPage",
                    type: "Telegenta_DialerToCallDetail",
                    time: new Date().toLocaleTimeString(),*/
                    data: "this is published message"
                };

                sforce.opencti.publish({channelName: channelName, message: message, callback: lightningMessageServiceCallback});
            }catch(ex){
                console.log(`Error---${ex}`);
            }
        }
        function lightningMessageServiceCallback(result) {
            try{
                if (result.success) {
                    console.log('Result--'+result.returnValue);
                } else {
                    console.log(result.errors);
                }
            }catch(ex){
                console.log(`Error---${ex}`);
            }
        }
        function subscribeSampleMCCallback(result) {
            try{
                if (result.success) {
                    console.log('result---'+JSON.stringify(result));
                    channelSubscription = result.subscription;
                    //console.log('channelSubscription---'+JSON.stringify(channelSubscription));
                } else {
                    console.log(result.errors);
                }
            }catch(ex){
                console.log(`Error---${ex}`);
            }
        }
        function onPublishMessage(message) {
            try{
                /*document.getElementById('opencti_testMessageTextArea').value = JSON.stringify(message);
                console.log('message----'+document.getElementById('opencti_testMessageTextArea').value);*/
                //console.log('message---'+JSON.stringify(message));
                var textArea = document.querySelector("#textareatoshowMsg");
            textArea.innerHTML = message ? JSON.stringify(message, null, '\t') : 'no message payload';

            }catch(ex){
                console.log(`Error---${ex}`);
            }
        }


    
</script>
</apex:page>